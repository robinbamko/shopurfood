!function(c){var d=void 0,s=void 0,l="https://widget.fuguchat.com",r="https://chat.fuguchat.com";isComplete=!1;var u,p="",a=!1,f={appSecretKey:"kenwfdhwoiujGSDIUUHU82E8HD98",collapseType:"hide",showData:!1,address:{city:"Chandigarh",country:"India"},customAttributes:{}},o=document.title;function i(){c.onblur=function(){!1,E.ActiveInactiveTabEvent({type:"ActiveInactiveTabEvent",data:{isActive:!1}},l)},c.onfocus=function(){!0,E.ActiveInactiveTabEvent({type:"ActiveInactiveTabEvent",data:{isActive:!0}},l)}}function n(e){"function"==typeof e.callback&&(p=e.callback,e.callback=""),f=e}function m(e,t){try{"complete"===document.readyState?(e&&0<Object.keys(e).length&&n(e),o=document.title,i(),y(e),d.addEventListener("load",b.load,!1),c.addEventListener("message",b.message,!1)):document.onreadystatechange=function(){"complete"===document.readyState&&m(e,t)}}catch(e){console.error("Widget exception: ",e)}void 0!==t&&1!=t||(u=e)}function g(t){t.data.body&&t.data.channel_id&&("Notification"in c?"granted"===Notification.permission?v(t):"denied"===Notification.permission&&"default"!==Notification.permission||function(){if(!c.Notification||!Notification.requestPermission)return!1;if("granted"==Notification.permission)throw new Error("You must only call this *before* calling Notification.requestPermission(), otherwise this feature detect would bug the user with an actual notification!");try{new Notification("")}catch(e){if("TypeError"==e.name)return!1}return!0}()&&!a&&Notification.requestPermission(function(e){a=!0,"granted"===e&&v(t)}):console.log("This browser does not support desktop notification"))}function v(t){var e=t.data.title,a={body:t.data.body,icon:t.data.icon,data:{url:l+"/chat/"+t.data.channel_id,channel_id:t.data.channel_id}};notification=new Notification(e,a),notification.onclick=function(e){E.FayeNotification({channel_id:t.data.channel_id},l),c.focus(),notification.close(),document.title=h(t.data.unread_count)}}function h(e){return(0<e?"("+e+") ":"")+o}function y(e){if(d)"function"==typeof p?(p.call(this),p=""):e.collapseType&&"hide"==e.collapseType&&(E.Expand({type:"Expand",data:{}},l),E.Expand({type:"Expand",data:{}},c.location.origin));else{var t=document.createElement("iframe");t.id="iframe_fuguWidgetContent",t.classList.add("collapsed"),e.collapseType&&"hide"==e.collapseType&&(t.dataset.collapsedHidden="true"),t.src=l,t.style.borderRadius="6px",t.border=0,document.body.appendChild(t),d=t}}function t(e){var t=["<link rel='stylesheet' href='"+r+"/public/build/css/circularIframe.css' />"],a=' <div id="fuguLauncherContainer" class="fugu-launcher hidden" onclick="toggle()"><p id="totalMessageCount" class="hidden" ></p><div class="fugu-launcher-open-icon defaultBackgroundColor"><img class="chat-icon" src="'+r+'/public/img/chat-icon-1.svg"/> <img class="cancel-icon" src="'+r+'/public/img/cancelbtn.svg" /></div></div >',o="<head>"+["<script async defer src='"+r+"/public/js/circularIframe.js' type='text/javascript' ><\/script>"].join("")+t.join("")+"</head><body class='collapsed'>"+a+"</body>",i=document.createElement("iframe");i.id="iframe_fuguWidget",i.classList.add("collapsed"),document.body.appendChild(i),i.contentWindow.document.open(),i.contentWindow.document.write(o),i.contentWindow.document.close(),s=i,e.collapseType&&"hide"==e.collapseType&&(i.dataset.collapsedHidden="true"),e.driverInfo&&Object.keys(e.driverInfo).length&&(s.style.width="0px",s.style.height="0px",s.style.position="fixed",s.style.left="-500px",s.style.top="-500px")}i();var e,C,b={load:function(e){console.log("loaded iframe",e),E.Initialize(f,l),t(f)},loadReseller:function(e){console.log("loaded iframe",e),E.InitializeReseller(f,l),t(f)},message:function(e){if(e.origin==l)switch(console.log("non circular iframe message",e),e.data.type){case"Collapse":d.classList.add("collapsed"),s.classList.add("collapsed"),s.classList.remove("notification-1"),d.classList.remove("notification-1"),E.Collapse({type:"Collapse",data:e.data},c.location.origin),(t=!!navigator.platform&&/iPad|iPhone|iPod/.test(navigator.platform))&&(d.classList.remove("ios-fix"),T());break;case"Expand":d.classList.remove("collapsed","notification-1"),s.classList.remove("collapsed","notification-1"),E.Expand(e.data,c.location.origin),(t=!!navigator.platform&&/iPad|iPhone|iPod/.test(navigator.platform))&&L();break;case"Config":E.Config(e.data,l);break;case"Notification":e.data.data.count&&!e.data.data.hideNotification&&(d.classList.add("notification-1"),s.classList.add("notification-1")),e.data.data.doNotUpdateOnTitleBar||(document.title=h(e.data.data.count)),E.Notification(e.data,l),E.unreadCountChanged(e);break;case"Shutdown":d.classList.add("collapsed"),s.classList.add("collapsed"),E.Collapse({type:"Collapse",data:e.data},c.location.origin),w(),u&&"hide"!=u.collapseType&&!u.hideWidget&&(console.log("_initData: ",u),m(u,!0));break;case"SetupComplete":isComplete=!0,"function"==typeof p?(p.call(this),p=""):f.collapseType&&"hide"==f.collapseType&&(E.Expand({type:"Expand",data:{}},l),E.Expand({type:"Expand",data:{}},c.location.origin)),E.FuguReady();break;case"IosFix":console.log("IosFix",e.data);var t=!!navigator.platform&&/iPhone|iPod/.test(navigator.platform),a=!!navigator.platform&&/iPad/.test(navigator.platform);t?e.data.data&&(void 0!==c.pageYOffset?c.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop):a&&(e.data.data?I():T());break;case"Image":n=e.data.data,console.log("image is clicked"),function(e){var t=document.createElement("div");t.id="imageContainer",t.onwheel=function(e){e.preventDefault(),e.stopPropagation()},t.ontouchmove=k;var a=document.createElement("button");a.id="closeimg",a.onclick=function(){document.body.removeChild(t)};var o=document.createTextNode("Close"),i=document.createElement("img");i.id="closeicon",i.src=r+"/public/img/close-btn.svg";var n=document.createElement("a");n.blank="target",n.id="downloadAnchor";var c=document.createTextNode("Download"),d=document.createElement("img");d.id="imageDownload",d.src=r+"/public/img/download.svg",n.appendChild(d),n.href=e;var s=document.createElement("div");s.id="imagediv";var l=document.createElement("img");l.id="WidgetImageMessage",l.src=e,s.appendChild(l),t.appendChild(s),a.appendChild(i),a.appendChild(o),n.appendChild(c),t.appendChild(a),t.appendChild(n),document.body.appendChild(t)}(n);break;case"FayeNotification":(i=e.data).data.agent_name&&(document.title=i.data.agent_name+" says"),setTimeout(function(){document.title=h(i.data.unread_count)},1e3),g(e.data)}else if(e.origin==c.location.origin)switch(console.log("circular iframe message",e),e.data.type){case"Collapse":E.Collapse(e.data,l),d&&d.classList.add("collapsed"),s&&s.classList.add("collapsed");var o=new CustomEvent("fuguWidgetCollapse",{});document.dispatchEvent(o);break;case"Expand":E.Expand(e.data,l),d&&d.classList.remove("collapsed","notification-1"),s&&s.classList.remove("collapsed","notification-1"),(t=!!navigator.platform&&/iPhone|iPod/.test(navigator.platform))&&L();break;case"ConfigCompleted":E.ConfigCompleted(e.data,l)}var i,n}},E={Initialize:function(e,t){x("Init",e,t)},InitializeReseller:function(e,t){x("InitReseller",e,t)},Expand:function(e,t){x("Expand",e,t)},Collapse:function(e,t){x("Collapse",e,t)},Config:function(e,t){x("Config",e,c.location.origin)},Notification:function(e,t){x("Notification",e,c.location.origin)},Shutdown:function(e,t){x("Shutdown",e,t)},StartConversation:function(e,t){x("StartConversation",e,t)},StartPeerToPeerConversation:function(e,t){x("StartPeerToPeerConversation",e,t)},ConfigCompleted:function(e,t){x("ConfigCompleted",e,t)},ShowImage:function(e,t){x("ShowImage",e,t)},Blur:function(e,t){x("Blur",e,t)},FuguReady:function(){var e=new CustomEvent("fuguWidgetReady",{});document.dispatchEvent(e)},BotMessage:function(e,t){x("BotMessage",e,t)},unreadCountChanged:function(e){var t=new CustomEvent("notificationCount",{detail:{count:e.data.data.count||0}});document.dispatchEvent(t)},FayeNotification:function(e,t){x("FayeNotification",e,t)},ActiveInactiveTabEvent:function(e,t){x("ActiveInactiveTabEvent",e,t)}};function x(e,t,a){a==c.location.origin?s&&s.contentWindow.postMessage({type:e,data:t,parent_origin:c.location.origin,current_url:c.location.href,hostname:c.location.hostname},a):d&&d.contentWindow.postMessage({type:e,data:t,parent_origin:c.location.origin,current_url:c.location.href,hostname:c.location.hostname},a)}function w(){d&&d.remove(),s&&s.remove(),s=d=void 0}function L(){d.classList.add("ios-fix"),I()}function I(){s.classList.add("ipad-fix"),d.classList.add("ipad-fix");var e=document.createElement("div");e.id="ipadLayer",e.ontouchmove=P,e.onclick=N,e.ontouchstart=N,document.body.appendChild(e),document.getElementsByTagName("html")[0].classList.add("ipad-fix-html"),document.body.classList.add("ipad-fix-body")}function T(){s.classList.remove("ipad-fix"),d.classList.remove("ipad-fix");var e=document.getElementById("ipadLayer");document.body.removeChild(e),document.getElementsByTagName("html")[0].classList.remove("ipad-fix-html"),document.body.classList.remove("ipad-fix-body")}function k(e){e.preventDefault(),e.stopPropagation()}function N(e){document.activeElement.blur(),T(),E.Blur({type:"Blur",data:{}},l)}function P(e){k(e),document.activeElement.blur()}function _(){E.Expand({type:"Expand",data:{}},c.location.origin)}document.addEventListener("notificationCount",function(e){console.log(e)}),c.fuguInit=m,c.fuguInitReseller=function e(t,a){try{"complete"===document.readyState?(t&&0<Object.keys(t).length&&n(t),i(),y(t),d.addEventListener("load",b.loadReseller,!1),c.addEventListener("message",b.message,!1)):document.onreadystatechange=function(){"complete"===document.readyState&&e(t,a)}}catch(e){console.error("Widget exception: ",e)}void 0!==a&&1!=a||(u=t)},c.fuguUpdate=function(e){w(),m(e,!1)},c.shutDownFugu=function(e){E.Shutdown({hostname:c.location.hostname,hideWidget:!!e&&e.hideWidget},l),localStorage.removeItem("f_uid_Id")},c.startConversation=function(e){isComplete&&(d.classList.remove("collapsed","notification-1"),s.classList.remove("collapsed","notification-1"),E.Expand({type:"Expand",data:{}},c.location.origin),E.StartConversation({data:e,origin:l},l))},c.startPeerToPeerConversation=function(e){isComplete&&(d.classList.remove("collapsed","notification-1"),s.classList.remove("collapsed","notification-1"),E.Expand({type:"Expand",data:{}},c.location.origin),E.StartPeerToPeerConversation({data:e,origin:l},l))},c.showConversationList=_,c.fuguWidget_Expand=_,c.fuguWidget_Collapse=function(){E.Collapse({type:"Collapse",data:{}},c.location.origin)},c.fuguWidget_BotMessage=function(e){E.BotMessage(e,l)},c.fuguDestroyCustomerWidget=w,e=document.getElementsByTagName("head")[0],(C=document.createElement("link")).id="FuguWidgetIframe_css",C.rel="stylesheet",C.type="text/css",C.href=r+"/public/build/css/widget.css",C.media="all",e.appendChild(C)}(window);